SRC = ../../tools
INC = ../Include
OD = obj
MODOPTS=-DMODVERSIONS -D__Linux__  -D__Pentium__ -DCONFIG_KERNELD -DMODULE -D__KERNEL__ -DLINUX
MODINC=-I$(INC) -I../../common/Headers -I$(SRC)
CC  = gcc
MODULE = TestEModule
OBJ = $(OD)/TEvents.o $(OD)/TELoader.o

all : $(MODULE).o TEClient


$(MODULE).o : $(OBJ)
	ld -m elf_i386 -r $(OBJ) -o $(MODULE).o

$(OD)/TEvents.o : $(SRC)/TEvents.c $(SRC)/TEvents.h TEClient.h $(INC)/MidiShareKernel.h
	$(CC) $(SRC)/TEvents.c $(MODINC) -c  $(MODOPTS) -D__NO_VERSION__ -o $(OD)/TEvents.o

$(OD)/TELoader.o : TELoader.c TEClient.h  $(SRC)/TEvents.h
	$(CC) TELoader.c $(MODINC) -c  $(MODOPTS) -o $(OD)/TELoader.o

TEClient : TEClient.c TEClient.h
	$(CC) TEClient.c -I$(INC) -lMidiShare -lpthread -o TEClient

install :
	if [ ! -c /dev/TestEvents ]; then mknod /dev/TestEvents c 153 0; fi
	insmod $(MODULE).o

uninstall : 
	if [ -c /dev/TestEvents ]; then rm /dev/TestEvents; fi
	rmmod $(MODULE)

clean :
	rm $(OBJ) $(MODULE).o TEClient
